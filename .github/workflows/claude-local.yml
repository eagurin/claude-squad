name: Claude Local Assistant

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  claude-local:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude-local')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude-local')) ||
      (github.event_name == 'issues' && contains(github.event.issue.body, '@claude-local'))
    runs-on: self-hosted  # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ñ‚Ð²Ð¾Ð¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ runner
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Process with local Claude
        run: |
          # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹
          COMMENT="${{ github.event.comment.body || github.event.issue.body }}"
          ISSUE_NUMBER="${{ github.event.issue.number || github.event.pull_request.number }}"
          
          # Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ @claude-local Ð¸Ð· ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ñ
          PROMPT=$(echo "$COMMENT" | sed 's/@claude-local//')
          
          # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð² Ñ„Ð°Ð¹Ð»
          echo "$PROMPT" > /tmp/claude-prompt.txt
          
          # Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Claude bridge
          python3 scripts/claude-github-bridge.py /tmp/claude-prompt.txt
          
          # Ð§Ð¸Ñ‚Ð°ÐµÐ¼ Ð¾Ñ‚Ð²ÐµÑ‚
          RESPONSE=$(cat /tmp/claude-response.txt)
          
      - name: Post response
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number || context.payload.pull_request.number;
            await github.rest.issues.createComment({
              ...context.repo,
              issue_number: issue_number,
              body: 'ðŸ¤– Claude Local: Response will be implemented once bridge is set up'
            });